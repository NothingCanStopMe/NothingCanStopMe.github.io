---
title: 给鱼添加简单阴影第二种方法
date: 2019-06-21 10:00:57
tags: 笔记
---

直接采用renderTexture实现, 只是阴影没有层次的区别, 适合静态使用
{% codeblock %}
local ShadowLayer = class("ShadowLayer", ccui.Layout)

function ShadowLayer:ctor(target, root)
	self.target = target
	local size = cc.Director:getInstance():getWinSize()
	self:setContentSize(cc.size(size.width, size.height))
	self:setAnchorPoint(cc.p(0,0))
	self:setPosition(cc.p(-15, 0))
	self.pRender = cc.RenderTexture:create(size.width, size.height, cc.TEXTURE2_D_PIXEL_FORMAT_RGB_A8888)
	self.pRender:setPosition(cc.p(size.width / 2, size.height / 2))
	self.pRender:getSprite():setBlendFunc(cc.blendFunc(GL_ZERO, GL_ONE_MINUS_SRC_ALPHA))
	self.pRender:getSprite():setOpacity(150)
	self.pRender:addTo(self)
	self.pRender:retain()

	self:scheduleUpdateWithPriorityLua(handler(self, self.update), 0.1)
end

function ShadowLayer:update(dt)
	self.pRender:clear(0, 0, 0, 0)
	self.pRender:begin()
	self.target:visit()
	self.pRender:endToLua()
end

function ShadowLayer:setShadowColor(color)
	self.pRender:clear(color.r, color.g, color.b, color.a)
end
return ShadowLayer

{% endcodeblock %}

原理是将鱼的layer渲染到renderTexture下, 然后改变renderTexture内的sprite的混色方案, 得到黑色阴影
<font size = 3, color = red> 只是有个bug, 会闪退, 由于本人对opengl研究较少, 暂时没查出什么问题 慎用此方法 </font>