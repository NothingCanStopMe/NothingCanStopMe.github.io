---
layout: 笔记
title: 二叉堆学习之最大堆
date: 2019-12-30 15:40:08
tags: 笔记
---

二叉堆
特性: 
1. 子节点的值比父节点的值小
2. 左节点的索引值为父节点的两倍
3. 右节点的索引值为父节点的两倍 + 1
4. 必须是一个完全二叉树, (节点集中在左侧)
5. 二叉堆的主要特性表现为最大堆

缺点:
只有堆顶的数据是固定最大的, 叶节点的数据大小无法预计

最大堆的代码:
{% codeblock %}

local MaxHeap = {}

function MaxHeap:ctor()
    -- 数据
    self.data = {}
    -- 内部元素个数
    self.count = 0
end

-- 用一个数组来初始化
function MaxHeap:initByArr(arr)
    self:ctor()
    for k,v in ipairs(arr) do
        self.count = self.count + 1
        self.data[self.count] = v
    end
    
    -- 从倒数第二层开始进行下沉操作
    for i = math.floor(self.count / 2), 1, -1 do
        self:shiftDown(i)
    end
end

-- 下沉操作(将这个值往下层比较, 找到最合适它待的层数)
function MaxHeap:shiftDown(k)
    -- 还有下一层
    while( 2 * k <= self.count) do
		local j = 2 *k
		-- 判断最后一个叶结点是不是右结点
		-- 如果是右节点那就+1 不是就原来的
		if (j + 1 <= self.count and self.data[j + 1] > self.data[j]) then 
			j = j + 1
		end

		-- 是否满足下沉条件, 父结点比子节点大
		if (self.data[k] >= self.data[j]) then 
			break
		end

		local tmp = self.data[k]
		self.data[k] = self.data[j]
		self.data[j] = tmp
		k = j
	end
end

-- 上浮操作(不断的与父结点比较, 直到到达根节点或者比父结点小才停止)
function MaxHeap:shiftUp(k)
    while(k >= 1 and self.data[math.floor(k / 2)] < self.data[k]) do
        local tmp = self.data[math.floor(k / 2)]
        self.data[math.floor(k / 2)] = self.data[k]
        self.data[k] = tmp
        k = math.floor(k / 2)
    end
end

-- 插入一个元素
function MaxHeap:insert(item)
    self.count = self.count + 1
    self.data[self.count] = item
    self:shiftUp(self.count)
end

-- 获取最大的元素, 或者也就是最大堆唯一能保证的特性啦
function MaxHeap:getMaxItem()
    return self.data[1]
end

-- 获取元素个数
function MaxHeap:size()
    return self.count
end

-- 判断二叉堆是否为空
function MaxHeap:isEmpty()
    return self.count == 0
end

-- 取出堆顶
function MaxHeap:extractMax()
    local ret = self.data[1]
    local tmp = self.data[self.count]
    self.data[self.count] = self.data[1]
    self.data[1] = tmp
    self.count = self.count - 1

    self:shiftDown(1)
    return ret
end

function MaxHeap:printHeapData()
    print(table.concat(self.data, ","))
end

-- 顺便添加点的测试代码
local myMaxHeap = {}
setmetatable(myMaxHeap, {__index = MaxHeap})
myMaxHeap:initByArr({1, 5, 3, 7, 9})
myMaxHeap:printHeapData()
print(myMaxHeap:getMaxItem())
print(myMaxHeap:extractMax(), myMaxHeap:getMaxItem())
{% endcodeblock %}